
{% set lists = {
	'Armors' : ['Helm', 'Shoulders', 'Coat', 'Gloves', 'Leggings', 'Boots', 'HelmAquatic'],
	'Backpack / Trinkets' : ['Backpack', 'Amulet', 'Accessory', 'Ring'],
	'Weapons two hands' : ['Greatsword', 'Hammer', 'Rifle', 'Staff', 'LongBow', 'ShortBow'],
	'Weapons one hand' : ['Sword', 'Axe', 'Mace', 'Dagger', 'Scepter', 'Pistol', 'Focus', 'Warhorn', 'Shield', 'Torch'],
	'Weapons aquatic' : ['Speargun', 'Harpoon', 'Trident'],
} %}

{% set characters = apiclient.characters %}
{% set nbcolumns = characters|length %}

{% if nbcolumns > 5 %}
	<script>
		$('#container').removeClass('container').addClass('container-fluid');
		$('.page-stuff').addClass('big');
	</script>
{% endif %}

<table class="table table-condensed">
	<tbody>
		{% block table_header %}
			<tr>
				{% set index = 0 %}
				{% for char in characters %}
					{% if index % 5 == 0 %}
						<th>
						</th>
					{% endif %}
					<th>
						{% if char %}
							<img src="{{ char.profession.icon }}" title="{{ char.profession.name }}" class="profession" />
							<a href="../character/{{ char.name }}">
								<b>{{ char.name }}</b>
							</a>
						{% endif %}
					</th>
					{% set index = index + 1 %}
				{% endfor %}
			</tr>
		{% endblock %}

		{% for title, types in lists %}
			{% block separator %}
				<tr class="separator">
					<td colspan="{{ nbcolumns + (nbcolumns/5)|round(0, 'ceil') }}" class="text-center"></td>
				</tr>
			{% endblock %}
			{% for type in types %}
				<tr>
					{% set index = 0 %}
					{% for char in characters %}
						{% if index % 5 == 0 %}
							<td class="type">
								{{ type }}
							</td>
						{% endif %}
						<td>
							{% if char %}
								{% for objtype, obj in char.equipments %}
									{% if objtype == type or obj.type == type %}
										{{ _self.object(obj) }}
									{% endif %}
								{% endfor %}
								{% for objtype, items in char.inventory %}
									{% if objtype == type %}
										{% for obj in items %}
											{{ _self.object(obj) }}
										{% endfor %}
									{% endif %}
								{% endfor %}
							{% endif %}
						</td>
						{% set index = index + 1 %}
					{% endfor %}
				</tr>
			{% endfor %}
		{% endfor %}

		{{ block('separator') }}
		{{ block('table_header') }}
	</tbody>
</table>

{% macro object(obj) %}
	<div class="object">
		<span class="icons">
			<a href="http://db.dulfy.net/item/{{ obj.id }}" target="_blank">
				<img data-toggle="tooltip" title="{{ obj.name }}" src="{{ obj.icon }}" class="item" />
			</a>
			{% for upgrade in obj.upgrades %}
				<a href="http://db.dulfy.net/item/{{ upgrade.id }}" target="_blank">
					<img data-toggle="tooltip" title="{{ upgrade.name }}" src="{{ upgrade.icon }}" class="infusion" />
				</a>
			{% endfor %}
			{% for infusion in obj.infusions %}
				<a href="http://db.dulfy.net/item/{{ infusion.id }}" target="_blank">
					<img data-toggle="tooltip" title="{{ infusion.name }}" src="{{ infusion.icon }}" class="upgrade" />
				</a>
			{% endfor %}
		</span>
		<span class="name">
			{% if obj.stats_name and obj.stats %}
				<span data-toggle="tooltip" title="{{ obj.stats }}" class="stats rarity-{{ obj.rarity }}">{{ obj.stats_name }}</span>
			{% elseif obj.stats_name %}
				<span data-toggle="tooltip" title="{{ obj.name }}" class="stats rarity-{{ obj.rarity }}">{{ obj.stats_name }}</span>
			{% elseif obj.stats %}
				<span data-toggle="tooltip" title="{{ obj.stats }}" class="stats rarity-{{ obj.rarity }}"><em>unknown</em></span>
			{% else %}
				<span data-toggle="tooltip" title="{{ obj.name }}" class="stats rarity-{{ obj.rarity }}"><em>unknown</em></span>
			{% endif %}
			{% if 'Weapon' in type %}
				<span class="text-muted"> {{ obj.type }}</span>
			{% endif %}
		</span>
	</div>
{% endmacro %}